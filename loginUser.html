<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Login - JeGo (Integrated)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Load Firebase SDK (Compat version like registrasi_jego.html) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // ================================================
    // KONFIGURASI
    // ================================================
    
    // Firebase Configuration
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyDpGc_CsbNi1igA29n6qDhcX0oDkHNVscc",
      authDomain: "game-balap-simpel.firebaseapp.com",
      databaseURL: "https://game-balap-simpel-default-rtdb.firebaseio.com",
      projectId: "game-balap-simpel",
      storageBucket: "game-balap-simpel.firebasestorage.app",
      messagingSenderId: "864576853495",
      appId: "1:864576853495:web:6f16eb757fd3d8affb0af2",
      measurementId: "G-YWJPK7Y3J4"
    };
    
    // ================================================
    // VARIABEL GLOBAL
    // ================================================
    let firebaseApp = null;
    let firebaseAuth = null;
    let firebaseDatabase = null;
    let recaptchaVerifier = null;
    let confirmationResult = null;
    let currentUser = null;
    let otpTimer = null;
    let otpCountdown = 60;
    
    // ================================================
    // FUNGSI UTILITAS
    // ================================================
    
    function showNotification(title, message, type = 'info') {
      const notification = document.getElementById('notificationPopup');
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      notification.className = `notification ${type}`;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 5000);
    }
    
    function showStatus(message, type) {
      const statusElement = document.getElementById('statusMessage');
      statusElement.textContent = message;
      statusElement.className = 'status-message';
      statusElement.classList.add(`status-${type}`);
      statusElement.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          statusElement.style.display = 'none';
        }, 5000);
      }
    }
    
    function showSmsStatus(message, type = 'sending') {
      const smsStatus = document.getElementById('smsStatus');
      smsStatus.textContent = message;
      smsStatus.className = 'sms-status';
      smsStatus.classList.add(type);
      smsStatus.style.display = 'block';
    }
    
    function hideSmsStatus() {
      const smsStatus = document.getElementById('smsStatus');
      smsStatus.style.display = 'none';
    }
    
    function showProgress(percent) {
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      
      progressContainer.style.display = 'block';
      progressBar.style.width = percent + '%';
    }
    
    function hideProgress() {
      const progressContainer = document.getElementById('progressContainer');
      progressContainer.style.display = 'none';
    }
    
    function formatPhoneNumber(phone) {
      let cleaned = phone.replace(/\D/g, '');
      if (cleaned.startsWith('0')) {
        cleaned = '+62' + cleaned.substring(1);
      } else if (cleaned.startsWith('62')) {
        cleaned = '+' + cleaned;
      } else if (!cleaned.startsWith('+')) {
        cleaned = '+62' + cleaned;
      }
      return cleaned;
    }
    
    function validatePhoneFormat(phone) {
      const phoneRegex = /^\+62[0-9]{9,12}$/;
      return phoneRegex.test(phone);
    }
    
    function setupOTPInput() {
      const otpInput = document.getElementById('otpInput');
      
      otpInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
        
        if (e.target.value.length > 6) {
          e.target.value = e.target.value.substring(0, 6);
        }
        
        if (e.target.value.length === 6) {
          e.target.classList.add('filled');
        } else {
          e.target.classList.remove('filled');
        }
      });
      
      otpInput.addEventListener('paste', function(e) {
        e.preventDefault();
        const pastedText = (e.clipboardData || window.clipboardData).getData('text');
        const numbersOnly = pastedText.replace(/[^0-9]/g, '');
        
        if (numbersOnly.length >= 6) {
          e.target.value = numbersOnly.substring(0, 6);
          e.target.classList.add('filled');
        }
      });
    }
    
    function getEnteredOTP() {
      return document.getElementById('otpInput').value;
    }
    
    function clearOTPInput() {
      document.getElementById('otpInput').value = '';
      document.getElementById('otpInput').classList.remove('filled');
    }
    
    function startResendCountdown(seconds) {
      const resendLink = document.getElementById('resendOtpLink');
      const countdownText = document.getElementById('countdownText');
      const countdownElement = document.getElementById('countdown');
      
      resendLink.classList.add('disabled');
      countdownText.style.display = 'inline';
      
      let countdown = seconds;
      countdownElement.textContent = countdown;
      
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          resendLink.classList.remove('disabled');
          countdownText.style.display = 'none';
        }
      }, 1000);
    }
    
    // ================================================
    // FIREBASE FUNCTIONS (100% CLIENT-SIDE)
    // ================================================
    
    async function initializeFirebase() {
      try {
        console.log('ðŸ”„ Menginisialisasi Firebase...');
        
        if (typeof firebase === 'undefined') {
          throw new Error('Firebase SDK belum dimuat');
        }
        
        // Initialize Firebase
        firebaseApp = firebase.initializeApp(FIREBASE_CONFIG);
        firebaseAuth = firebase.auth();
        firebaseDatabase = firebase.database();
        
        console.log('âœ… Firebase diinisialisasi');
        return true;
      } catch (error) {
        console.error('âŒ Error menginisialisasi Firebase:', error);
        showNotification('Error', 'Gagal menginisialisasi Firebase. Silakan refresh halaman.', 'error');
        return false;
      }
    }
    
    function setupRecaptcha() {
      try {
        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
          'size': 'normal',
          'callback': function(response) {
            console.log('âœ… reCAPTCHA verified');
          },
          'expired-callback': function() {
            console.log('âŒ reCAPTCHA expired');
            showNotification('Error', 'reCAPTCHA telah kadaluarsa. Silakan coba lagi.', 'error');
          }
        });
        
        recaptchaVerifier.render();
        console.log('âœ… reCAPTCHA diatur');
      } catch (error) {
        console.error('âŒ Error setting up reCAPTCHA:', error);
        showNotification('Error', 'Gagal mengatur reCAPTCHA. Silakan refresh halaman.', 'error');
      }
    }
    
    async function checkPhoneNumberInDatabase(phoneNumber) {
      try {
        console.log('ðŸ” Checking phone in database:', phoneNumber);
        
        // Query database untuk mencari user dengan nomor telepon yang sama
        const snapshot = await firebaseDatabase.ref('users')
          .orderByChild('phone')
          .equalTo(phoneNumber)
          .once('value');
        
        const data = snapshot.val();
        
        if (data) {
          // Ambil user pertama yang ditemukan
          const userId = Object.keys(data)[0];
          const userData = data[userId];
          
          return {
            exists: true,
            user: userData,
            userId: userId
          };
        }
        
        return {
          exists: false,
          user: null,
          userId: null
        };
      } catch (error) {
        console.error('âŒ Error checking phone number:', error);
        return {
          exists: false,
          error: error.message
        };
      }
    }
    
    async function sendFirebaseOTP(phoneNumber) {
      try {
        showSmsStatus('ðŸ“± Mengirim OTP...', 'sending');
        
        if (!recaptchaVerifier) {
          throw new Error('reCAPTCHA belum diatur');
        }
        
        confirmationResult = await firebaseAuth.signInWithPhoneNumber(phoneNumber, recaptchaVerifier);
        
        showSmsStatus('âœ… OTP berhasil dikirim via SMS', 'success');
        console.log('âœ… Kode OTP dikirim via Firebase');
        return true;
      } catch (error) {
        console.error('âŒ Error sending OTP:', error);
        
        let errorMessage = 'Gagal mengirim kode OTP. ';
        switch (error.code) {
          case 'auth/invalid-phone-number':
            errorMessage += 'Format nomor telepon tidak valid.';
            break;
          case 'auth/too-many-requests':
            errorMessage += 'Terlalu banyak permintaan. Silakan coba lagi nanti.';
            break;
          case 'auth/quota-exceeded':
            errorMessage += 'Kuota SMS telah habis. Silakan hubungi administrator.';
            break;
          case 'auth/captcha-check-failed':
            errorMessage += 'Verifikasi keamanan gagal. Silakan refresh halaman.';
            break;
          default:
            errorMessage += error.message || 'Silakan coba lagi.';
        }
        
        showSmsStatus('âŒ ' + errorMessage, 'error');
        return false;
      }
    }
    
    async function verifyFirebaseOTP(code) {
      try {
        showSmsStatus('ðŸ” Memverifikasi OTP...', 'sending');
        
        if (!confirmationResult) {
          throw new Error('Sesi OTP tidak valid. Silakan minta OTP baru.');
        }
        
        const userCredential = await confirmationResult.confirm(code);
        const user = userCredential.user;
        
        showSmsStatus('âœ… OTP berhasil diverifikasi', 'success');
        console.log('âœ… OTP verified, user:', user.uid);
        return user;
      } catch (error) {
        console.error('âŒ Error verifying OTP:', error);
        
        let errorMessage = 'Gagal memverifikasi OTP. ';
        switch (error.code) {
          case 'auth/invalid-verification-code':
            errorMessage += 'Kode OTP tidak valid.';
            break;
          case 'auth/code-expired':
            errorMessage += 'Kode OTP telah kadaluarsa.';
            break;
          default:
            errorMessage += error.message || 'Silakan coba lagi.';
        }
        
        showSmsStatus('âŒ ' + errorMessage, 'error');
        return null;
      }
    }
    
    // ================================================
    // EVENT HANDLERS
    // ================================================
    
    async function handleLoginSubmit(e) {
      e.preventDefault();
      
      const loginBtn = document.getElementById('loginBtn');
      const telepon = document.getElementById('teleponInput').value.trim();
      
      if (!telepon) {
        showStatus('Harap masukkan nomor telepon.', 'error');
        return;
      }
      
      // Format nomor telepon
      const formattedPhone = formatPhoneNumber(telepon);
      
      if (!validatePhoneFormat(formattedPhone)) {
        showStatus('Format nomor telepon tidak valid. Gunakan format: 08123456789', 'error');
        return;
      }
      
      // Disable button
      loginBtn.disabled = true;
      loginBtn.classList.add('btn-loading');
      loginBtn.textContent = 'Mengecek...';
      showProgress(20);
      
      try {
        // 1. Cek apakah nomor terdaftar di database
        showProgress(40);
        const phoneInfo = await checkPhoneNumberInDatabase(formattedPhone);
        
        if (phoneInfo.exists) {
          const userData = phoneInfo.user;
          
          // Cek status akun
          const userStatus = userData.status || 'active';
          
          if (userStatus === 'blocked_permanent' || userStatus === 'banned') {
            showStatus('Akun diblokir permanen. Tidak dapat login.', 'error');
            return;
          }
          
          if (userStatus === 'inactive') {
            showStatus('Akun tidak aktif. Hubungi administrator.', 'error');
            return;
          }
          
          // Simpan data user sementara
          currentUser = {
            userId: phoneInfo.userId,
            phone: formattedPhone,
            userData: userData
          };
          
          // 2. Kirim OTP
          showProgress(60);
          const otpSent = await sendFirebaseOTP(formattedPhone);
          
          if (otpSent) {
            // 3. Tampilkan OTP section
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('otpSection').style.display = 'block';
            document.getElementById('otpInput').focus();
            
            startResendCountdown(60);
            showProgress(100);
            showNotification('OTP Dikirim', 'Kode OTP telah dikirim via SMS.', 'info');
          }
          
        } else {
          showStatus('Nomor telepon tidak terdaftar.', 'error');
          showNotification('Info', 'Nomor tidak terdaftar. Silakan daftar terlebih dahulu.', 'info');
        }
        
      } catch (error) {
        console.error('Login error:', error);
        showStatus(`Error: ${error.message}`, 'error');
      } finally {
        setTimeout(() => {
          loginBtn.disabled = false;
          loginBtn.classList.remove('btn-loading');
          loginBtn.textContent = 'Kirim Kode OTP';
          hideProgress();
        }, 1000);
      }
    }
    
    async function handleVerifyOtp() {
      const verifyBtn = document.getElementById('verifyOtpBtn');
      const enteredOtp = getEnteredOTP();
      
      if (enteredOtp.length !== 6) {
        showStatus('Harap masukkan kode OTP 6 digit lengkap.', 'error');
        return;
      }
      
      if (!currentUser) {
        showStatus('Sesi tidak valid.', 'error');
        return;
      }
      
      verifyBtn.disabled = true;
      verifyBtn.classList.add('btn-loading');
      verifyBtn.textContent = 'Memverifikasi...';
      
      try {
        // 1. Verify OTP dengan Firebase
        const firebaseUser = await verifyFirebaseOTP(enteredOtp);
        
        if (firebaseUser) {
          // 2. AMBIL DATA USER DARI FIREBASE DATABASE
          const userRef = firebaseDatabase.ref('users/' + firebaseUser.uid);
          const snapshot = await userRef.once('value');
          const dbUser = snapshot.val();
          
          if (!dbUser) {
            showStatus('Data user tidak ditemukan.', 'error');
            return;
          }
          
          // 3. âœ… BUAT SESSION DENGAN STRUKTUR STANDAR
          const sessionUser = {
            userId: firebaseUser.uid,
            uid: firebaseUser.uid,
            name: dbUser.name || '',
            phone: dbUser.phone || '',
            email: dbUser.email || '',
            gender: dbUser.gender || '',
            address: dbUser.address || '',
            status: dbUser.status || "active",
            photoURL: dbUser.fotoProfilURL || "",
            rating: dbUser.rating || 5,
            perjalanan: dbUser.perjalanan || 0,
            createdAt: dbUser.createdAt || new Date().toISOString()
          };
          
          // 4. âœ… SIMPAN KE LOCALSTORAGE (KEY STANDAR)
          localStorage.setItem('jego_logged_in_user', JSON.stringify(sessionUser));
          
          // 5. Tampilkan success
          showStatus('Login berhasil! Mengalihkan...', 'success');
          showNotification('Login Berhasil', 'Login berhasil!', 'success');
          
          // 6. Redirect ke halaman utama
          setTimeout(() => {
            window.location.href = 'jenis_kenderaan.html';
          }, 1500);
        }
      } catch (error) {
        console.error('Verify error:', error);
        showStatus(`Gagal: ${error.message}`, 'error');
        clearOTPInput();
        document.getElementById('otpInput').focus();
      } finally {
        setTimeout(() => {
          verifyBtn.disabled = false;
          verifyBtn.classList.remove('btn-loading');
          verifyBtn.textContent = 'Verifikasi OTP';
        }, 1000);
      }
    }
    
    async function handleResendOtp() {
      const resendLink = document.getElementById('resendOtpLink');
      
      if (resendLink.classList.contains('disabled')) {
        return;
      }
      
      if (!currentUser) {
        showStatus('Sesi tidak valid.', 'error');
        return;
      }
      
      resendLink.classList.add('disabled');
      showSmsStatus('ðŸ”„ Mengirim ulang OTP...', 'sending');
      
      try {
        await sendFirebaseOTP(currentUser.phone);
        
        showStatus('OTP baru telah dikirim.', 'info');
        clearOTPInput();
        document.getElementById('otpInput').focus();
        startResendCountdown(60);
        
      } catch (error) {
        console.error('Resend error:', error);
        showStatus(`Gagal: ${error.message}`, 'error');
        resendLink.classList.remove('disabled');
      }
    }
    
    async function checkExistingSession() {
      // Cek localStorage dengan KEY STANDAR
      const localUser = localStorage.getItem('jego_logged_in_user');
      if (localUser) {
        try {
          const user = JSON.parse(localUser);
          showStatus(`Selamat datang kembali, ${user.name}`, 'info');
          
          setTimeout(() => {
            window.location.href = 'jenis_kenderaan.html';
          }, 1500);
          return true;
        } catch (error) {
          console.error('Error parsing user:', error);
          // Hapus session yang corrupt
          localStorage.removeItem('jego_logged_in_user');
        }
      }
      
      return false;
    }
    
    function setupAuthListener() {
      firebaseAuth.onAuthStateChanged((user) => {
        if (user) {
          console.log('âœ… User already logged in via Firebase Auth:', user.uid);
        }
      });
    }
    
    // ================================================
    // INITIALIZATION
    // ================================================
    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('ðŸ“„ DOM fully loaded, initializing...');
      
      setupOTPInput();
      
      // Initialize Firebase
      const firebaseReady = await initializeFirebase();
      
      if (firebaseReady) {
        console.log('âœ… Firebase ready, setting up reCAPTCHA...');
        setupAuthListener();
        
        // Setup reCAPTCHA dengan delay untuk memastikan library siap
        setTimeout(() => {
          setupRecaptcha();
        }, 1000);
      }
      
      // Event Listeners
      document.getElementById('loginForm').addEventListener('submit', handleLoginSubmit);
      document.getElementById('verifyOtpBtn').addEventListener('click', handleVerifyOtp);
      document.getElementById('resendOtpLink').addEventListener('click', handleResendOtp);
      document.getElementById('registerBtn').addEventListener('click', () => {
        window.location.href = 'registrasi_jego.html';
      });
      
      // Enter key support
      document.getElementById('teleponInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('loginBtn').click();
        }
      });
      
      document.getElementById('otpInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('verifyOtpBtn').click();
        }
      });
      
      // Auto-focus
      document.getElementById('teleponInput').focus();
      
      // Check if already logged in
      checkExistingSession();
    });
  </script>

  <style>
    /* STYLE CSS YANG SAMA DENGAN SEBELUMNYA */
    :root {
      --primary: #1e6f5c;
      --secondary: #289672;
      --accent: #e6dd3b;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.4;
      font-size: 0.85rem;
    }

    /* Header Styles */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo-container {
      display: flex;
      align-items: center;
    }

    .logo {
      width: 40px;
      height: 40px;
      background-color: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-weight: bold;
      font-size: 16px;
      color: var(--primary);
    }

    .header-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    /* Container Styles */
    .container {
      max-width: 100%;
      padding: 15px;
    }

    .form-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      max-width: 500px;
      margin: 0 auto;
    }

    .form-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--dark);
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: border-color 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(30, 111, 92, 0.1);
    }

    .submit-btn {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      width: 100%;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }

    .submit-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .secondary-btn {
      background: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
      border-radius: 8px;
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-top: 10px;
    }

    .secondary-btn:hover {
      background: rgba(30, 111, 92, 0.05);
    }

    /* Status Messages */
    .status-message {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      display: none;
    }

    .status-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    /* OTP Section */
    .otp-section {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .otp-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 15px;
      text-align: center;
    }

    .otp-info {
      margin-bottom: 20px;
      font-size: 0.9rem;
      text-align: center;
      color: #666;
    }

    /* SINGLE OTP INPUT */
    .otp-single-input {
      width: 100%;
      padding: 15px;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      letter-spacing: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      transition: all 0.3s;
      font-family: 'Courier New', monospace;
    }

    .otp-single-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(30, 111, 92, 0.2);
      outline: none;
    }

    .otp-single-input.filled {
      border-color: var(--primary);
      background-color: #f8fff9;
    }

    .resend-otp {
      text-align: center;
      margin-top: 15px;
      font-size: 0.85rem;
    }

    .resend-link {
      color: var(--primary);
      cursor: pointer;
      text-decoration: underline;
    }

    .resend-link:hover {
      color: var(--secondary);
    }

    .resend-link.disabled {
      color: #999;
      cursor: not-allowed;
      text-decoration: none;
    }

    /* Badge Lokal */
    .local-badge {
      display: inline-block;
      background-color: var(--accent);
      color: var(--dark);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      margin-top: 10px;
      font-size: 0.8rem;
      text-align: center;
      width: 100%;
    }

    .app-info {
      text-align: center;
      margin: 15px 0;
      font-size: 0.85rem;
      color: var(--dark);
      opacity: 0.8;
    }

    /* Loading State */
    .btn-loading {
      position: relative;
      color: transparent !important;
    }

    .btn-loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin-top: -10px;
      margin-left: -10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress Bar */
    .progress-container {
      height: 4px;
      background-color: #e0e0e0;
      border-radius: 2px;
      margin: 10px 0;
      overflow: hidden;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      width: 0%;
      transition: width 0.3s ease;
    }

    /* Notification Popup */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border-left: 4px solid var(--primary);
      z-index: 1000;
      display: none;
      max-width: 300px;
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.info {
      border-left-color: var(--primary);
    }

    .notification-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .notification-message {
      font-size: 0.85rem;
      color: #666;
    }

    /* SMS Status Indicator */
    .sms-status {
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
      text-align: center;
      font-size: 0.9rem;
      display: none;
    }

    .sms-status.success {
      background-color: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }

    .sms-status.error {
      background-color: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }

    .sms-status.sending {
      background-color: #e3f2fd;
      color: #1565c0;
      border: 1px solid #bbdefb;
    }

    /* Recaptcha Container */
    #recaptcha-container {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      min-height: 80px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-title {
        font-size: 1rem;
      }
      
      body {
        font-size: 0.8rem;
      }
      
      .form-container {
        padding: 15px;
      }
      
      .otp-single-input {
        font-size: 1.5rem;
        letter-spacing: 8px;
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo-container">
      <div class="logo">JG</div>
      <div class="header-title">JeGo</div>
    </div>
  </div>

  <!-- Container -->
  <div class="container">
    <div class="form-container">
      <h1 class="form-title">Login User</h1>
      <div class="local-badge">100% CLIENT-SIDE DENGAN FIREBASE</div>
      <div class="app-info">
        JeGo - Jasa Ekspedisi Gorontalo
      </div>
      
      <!-- SMS Status Indicator -->
      <div class="sms-status" id="smsStatus"></div>
      
      <!-- Status Message -->
      <div class="status-message" id="statusMessage"></div>
      
      <!-- Recaptcha Container -->
      <div id="recaptcha-container"></div>
      
      <!-- Progress Bar -->
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <!-- Form Login -->
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="teleponInput">Nomor Telepon *</label>
          <input type="tel" class="form-input" id="teleponInput" placeholder="Contoh: 08123456789" required inputmode="numeric" pattern="[0-9]*">
          <small style="color: #666; font-size: 0.8rem; margin-top: 5px; display: block;">
            Pastikan nomor aktif dan dapat menerima SMS
          </small>
        </div>
        
        <button type="submit" class="submit-btn" id="loginBtn">Kirim Kode OTP</button>
        
        <button type="button" class="secondary-btn" id="registerBtn">Belum punya akun? Daftar Sekarang</button>
      </form>
      
      <!-- OTP Verification Section -->
      <div class="otp-section" id="otpSection">
        <h2 class="otp-title">Verifikasi OTP</h2>
        
        <div class="otp-info">
          <p>Kode OTP telah dikirim via SMS ke nomor Anda.</p>
          <p>Masukkan kode OTP 6 digit untuk melanjutkan.</p>
        </div>
        
        <!-- SINGLE OTP INPUT -->
        <input type="text" 
               class="otp-single-input" 
               id="otpInput" 
               maxlength="6" 
               inputmode="numeric" 
               pattern="[0-9]*" 
               placeholder="000000"
               autocomplete="one-time-code">
        
        <button type="button" class="submit-btn" id="verifyOtpBtn">Verifikasi OTP</button>
        
        <div class="resend-otp">
          <span id="resendText">Tidak menerima kode? </span>
          <span class="resend-link" id="resendOtpLink">Kirim ulang OTP</span>
          <span id="countdownText" style="display: none;"> (Tunggu <span id="countdown">60</span> detik)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Popup -->
  <div class="notification" id="notificationPopup">
    <div class="notification-title" id="notificationTitle">Informasi</div>
    <div class="notification-message" id="notificationMessage"></div>
  </div>
</body>
</html>
