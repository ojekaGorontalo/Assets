<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pilih Kendaraan - JeGo</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f5f5f5}
header{background:#ff9800;color:#fff;padding:15px;text-align:center}
.container{padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px;cursor:pointer;border:2px solid #eee}
.card.active{border-color:#ff9800}
.btn{display:block;text-align:center;background:#ff9800;color:#fff;padding:12px;border-radius:8px;text-decoration:none;margin-top:20px}
.hidden{display:none}
.loading{position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;font-size:18px}
</style>
</head>

<body>

<div class="loading hidden" id="loading">Memproses...</div>

<header>
  <h2>Pilih Kendaraan</h2>
</header>

<div class="container" id="loginRequired" class="hidden">
  <p>Silakan login terlebih dahulu</p>
  <a href="userLogin.html" class="btn">Login</a>
</div>

<div class="container hidden" id="mainContent">

  <div class="card" onclick="selectVehicle('motor')">ğŸ Motor (1 Penumpang)</div>
  <div class="card" onclick="selectVehicle('bentor')">ğŸ›º Bentor (2 Penumpang)</div>
  <div class="card" onclick="selectVehicle('mobil')">ğŸš— Mobil (4 Penumpang)</div>
  <div class="card" onclick="selectVehicle('kurir_motor')">ğŸ“¦ Kurir Motor</div>
  <div class="card" onclick="selectVehicle('kurir_bentor')">ğŸ“¦ Kurir Bentor</div>

</div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyDpGc_CsbNi1igA29n6qDhcX0oDkHNVscc",
  authDomain: "game-balap-simpel.firebaseapp.com",
  databaseURL: "https://game-balap-simpel-default-rtdb.firebaseio.com",
  projectId: "game-balap-simpel",
  storageBucket: "game-balap-simpel.firebasestorage.app",
  messagingSenderId: "864576853495",
  appId: "1:864576853495:web:6f16eb757fd3d8affb0af2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

/* ================= CEK LOGIN ================= */
const userLocal = localStorage.getItem('jego_logged_in_user');
const mainContent = document.getElementById('mainContent');
const loginRequired = document.getElementById('loginRequired');
const loading = document.getElementById('loading');

if(!userLocal){
  loginRequired.classList.remove('hidden');
}else{
  mainContent.classList.remove('hidden');
}

/* ================= DATA KENDARAAN ================= */
const vehicleData = {
  motor:{name:'Motor',tarif:2200,min:10000},
  bentor:{name:'Bentor',tarif:3000,min:11000},
  mobil:{name:'Mobil',tarif:4000,min:15000},
  kurir_motor:{name:'Kurir Motor',tarif:2100,min:10000},
  kurir_bentor:{name:'Kurir Bentor',tarif:2100,min:10000}
};

/* ================= PILIH KENDARAAN ================= */
function selectVehicle(type){
  loading.classList.remove('hidden');

  const user = JSON.parse(userLocal);

  const selected = {
    type,
    ...vehicleData[type],
    userId:user.uid,
    time:new Date().toISOString()
  };

  localStorage.setItem('jego_last_transport',JSON.stringify(selected));

  // Kirim ke Kodular
  if(window.AppInventor){
    window.AppInventor.setWebViewString(JSON.stringify({
      action:'vehicle_selected',
      data:selected
    }));
  }

  setTimeout(()=>{
    location.href='rute.html';
  },800);
}
</script>

</body>
</html>
