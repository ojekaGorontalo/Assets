<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lapak Inayah - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-logo i {
            font-size: 2.5rem;
        }
        
        .admin-logo h1 {
            font-size: 1.8rem;
        }
        
        .admin-nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .admin-nav a:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        
        .pending .stat-icon { background: #f39c12; }
        .processing .stat-icon { background: #3498db; }
        .completed .stat-icon { background: #2ecc71; }
        .total .stat-icon { background: #9b59b6; }
        
        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 0;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid #e74c3c;
            color: #e74c3c;
            background: #fff5f5;
        }
        
        /* Orders Table */
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .orders-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #eee;
        }
        
        .orders-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .order-id {
            font-weight: 600;
            color: #3498db;
        }
        
        .order-customer {
            font-weight: 500;
        }
        
        .order-customer small {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .order-items {
            max-width: 250px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .order-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-process {
            background: #3498db;
            color: white;
        }
        
        .btn-complete {
            background: #2ecc71;
            color: white;
        }
        
        .btn-cancel {
            background: #e74c3c;
            color: white;
        }
        
        .btn-whatsapp {
            background: #25D366;
            color: white;
        }
        
        /* Menu Management */
        .menu-management {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .add-menu-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .menu-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: none;
        }
        
        .menu-form.active {
            display: block;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .orders-table {
                display: block;
                overflow-x: auto;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .admin-header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .admin-nav a {
                margin: 0 5px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                min-width: 120px;
            }
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1.2rem;
            color: #666;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        /* Back to Home */
        .back-home {
            display: inline-block;
            margin-top: 20px;
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-home:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="admin-header-content">
                <div class="admin-logo">
                    <i class="fas fa-user-shield"></i>
                    <div>
                        <h1>Lapak Inayah Admin Panel</h1>
                        <p>Kelola pesanan dan menu makanan</p>
                    </div>
                </div>
                <nav class="admin-nav">
                    <a href="index.html" target="_blank"><i class="fas fa-home"></i> Halaman Customer</a>
                    <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </nav>
            </div>
        </header>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card pending">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3 id="pendingCount">0</h3>
                    <p>Menunggu Diproses</p>
                </div>
            </div>
            
            <div class="stat-card processing">
                <div class="stat-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="stat-info">
                    <h3 id="processingCount">0</h3>
                    <p>Sedang Diproses</p>
                </div>
            </div>
            
            <div class="stat-card completed">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="completedCount">0</h3>
                    <p>Selesai</p>
                </div>
            </div>
            
            <div class="stat-card total">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalOrders">0</h3>
                    <p>Total Pesanan</p>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="orders">Pesanan Masuk</div>
            <div class="tab" data-tab="menu">Kelola Menu</div>
        </div>
        
        <!-- Orders Tab -->
        <div class="tab-content active" id="ordersTab">
            <h2 style="margin-bottom: 20px;">Daftar Pesanan</h2>
            <div id="ordersContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Memuat data pesanan...
                </div>
            </div>
        </div>
        
        <!-- Menu Management Tab -->
        <div class="tab-content" id="menuTab">
            <div class="menu-management">
                <div class="section-header">
                    <h2>Kelola Menu Makanan</h2>
                    <button class="add-menu-btn" id="addMenuBtn">
                        <i class="fas fa-plus"></i> Tambah Menu
                    </button>
                </div>
                
                <!-- Add/Edit Menu Form -->
                <div class="menu-form" id="menuForm">
                    <h3 id="formTitle">Tambah Menu Baru</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="menuName">Nama Menu*</label>
                            <input type="text" id="menuName" placeholder="Nama makanan/minuman">
                        </div>
                        <div class="form-group">
                            <label for="menuPrice">Harga*</label>
                            <input type="number" id="menuPrice" placeholder="Harga dalam Rupiah">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="menuDescription">Deskripsi</label>
                        <textarea id="menuDescription" rows="3" placeholder="Deskripsi menu"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="menuImage">URL Gambar</label>
                        <input type="text" id="menuImage" placeholder="https://example.com/gambar.jpg">
                    </div>
                    
                    <div class="form-buttons">
                        <button class="action-btn btn-complete" id="saveMenuBtn">
                            <i class="fas fa-save"></i> Simpan Menu
                        </button>
                        <button class="action-btn btn-cancel" id="cancelMenuBtn">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
                
                <!-- Menu List -->
                <h3 style="margin-top: 30px;">Daftar Menu</h3>
                <div id="menuListContainer">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Memuat menu...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Back to Home -->
        <a href="index.html" class="back-home">
            <i class="fas fa-arrow-left"></i> Kembali ke Halaman Utama
        </a>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDa3JXfyzGgVyzBqf0uL_P-DuU97RhhTv8",
            authDomain: "game-balap-simpel.firebaseapp.com",
            databaseURL: "https://game-balap-simpel-default-rtdb.firebaseio.com",
            projectId: "game-balap-simpel",
            storageBucket: "game-balap-simpel.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Global variables
        let orders = {};
        let menu = [];
        let editingMenuId = null;
        
        // Load orders from Firebase
        function loadOrders() {
            database.ref('Lapak Inayah/orders').on('value', (snapshot) => {
                orders = snapshot.val() || {};
                updateStats();
                renderOrders(orders);
            });
        }
        
        // Load menu from Firebase
        function loadMenu() {
            database.ref('Lapak Inayah/menu').on('value', (snapshot) => {
                menu = snapshot.val() || [];
                renderMenuList(menu);
            });
        }
        
        // Update statistics
        function updateStats() {
            let pending = 0;
            let processing = 0;
            let completed = 0;
            let total = 0;
            
            Object.values(orders).forEach(order => {
                total++;
                if (order.status === 'pending') pending++;
                if (order.status === 'processing') processing++;
                if (order.status === 'completed') completed++;
            });
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('processingCount').textContent = processing;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalOrders').textContent = total;
        }
        
        // Render orders table
        function renderOrders(orders) {
            const container = document.getElementById('ordersContainer');
            
            if (!orders || Object.keys(orders).length === 0) {
                container.innerHTML = '<div class="no-data"><i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px;"></i><p>Belum ada pesanan</p></div>';
                return;
            }
            
            // Sort orders by timestamp (newest first)
            const sortedOrders = Object.entries(orders).sort((a, b) => b[1].timestamp - a[1].timestamp);
            
            let tableHTML = `
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>ID Pesanan</th>
                            <th>Customer</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            sortedOrders.forEach(([orderId, order]) => {
                // Format items
                let itemsHTML = '';
                Object.values(order.items).forEach(item => {
                    if (item.qty > 0) {
                        itemsHTML += `
                            <div class="order-item">
                                <span>${item.nama}</span>
                                <span>x${item.qty}</span>
                            </div>
                        `;
                    }
                });
                
                // Status badge
                let statusClass = '';
                let statusText = '';
                switch(order.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'Menunggu';
                        break;
                    case 'processing':
                        statusClass = 'status-processing';
                        statusText = 'Diproses';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'Selesai';
                        break;
                    default:
                        statusClass = 'status-pending';
                        statusText = order.status;
                }
                
                tableHTML += `
                    <tr>
                        <td>
                            <div class="order-id">${orderId}</div>
                            <small>${order.orderDate || new Date(order.timestamp).toLocaleString('id-ID')}</small>
                        </td>
                        <td>
                            <div class="order-customer">${order.customer.name}</div>
                            <small>${order.customer.phone}</small>
                            <small>${order.customer.address}</small>
                            ${order.customer.note ? `<small><strong>Catatan:</strong> ${order.customer.note}</small>` : ''}
                        </td>
                        <td class="order-items">${itemsHTML}</td>
                        <td>Rp ${formatNumber(order.total)}</td>
                        <td>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${order.status === 'pending' ? `
                                    <button class="action-btn btn-process" onclick="updateOrderStatus('${orderId}', 'processing')">
                                        Proses
                                    </button>
                                    <button class="action-btn btn-whatsapp" onclick="contactCustomer('${order.customer.phone}', '${orderId}')">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                ` : ''}
                                
                                ${order.status === 'processing' ? `
                                    <button class="action-btn btn-complete" onclick="updateOrderStatus('${orderId}', 'completed')">
                                        Selesai
                                    </button>
                                    <button class="action-btn btn-whatsapp" onclick="contactCustomer('${order.customer.phone}', '${orderId}')">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                ` : ''}
                                
                                ${order.status === 'completed' ? `
                                    <button class="action-btn btn-process" disabled>
                                        Selesai
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }
        
        // Render menu list
        function renderMenuList(menu) {
            const container = document.getElementById('menuListContainer');
            
            if (!menu || menu.length === 0) {
                container.innerHTML = '<div class="no-data"><i class="fas fa-utensils" style="font-size: 3rem; margin-bottom: 15px;"></i><p>Belum ada menu. Tambah menu baru!</p></div>';
                return;
            }
            
            let menuHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
            
            menu.forEach((item, index) => {
                menuHTML += `
                    <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.05);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <img src="${item.gambar || 'https://via.placeholder.com/80x80?text=Menu'}" 
                                 alt="${item.nama}" 
                                 style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                            <div>
                                <h4 style="margin-bottom: 5px;">${item.nama}</h4>
                                <p style="color: #e74c3c; font-weight: bold;">Rp ${formatNumber(item.harga)}</p>
                            </div>
                        </div>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">${item.deskripsi || '-'}</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn btn-process" onclick="editMenu(${index})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn btn-cancel" onclick="deleteMenu(${index})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
            });
            
            menuHTML += '</div>';
            container.innerHTML = menuHTML;
        }
        
        // Update order status
        function updateOrderStatus(orderId, status) {
            if (!orderId || !status) return;
            
            database.ref('Lapak Inayah/orders/' + orderId + '/status').set(status)
                .then(() => {
                    alert(`Status pesanan ${orderId} berhasil diubah menjadi ${status}`);
                })
                .catch(error => {
                    console.error('Error updating order:', error);
                    alert('Gagal mengubah status pesanan');
                });
        }
        
        // Contact customer via WhatsApp
        function contactCustomer(phone, orderId) {
            const message = `Halo, saya dari Lapak Inayah. Mengkonfirmasi pesanan ${orderId}. Apakah pesanan Anda sudah sesuai?`;
            const url = `https://wa.me/${phone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }
        
        // Menu management functions
        document.getElementById('addMenuBtn').addEventListener('click', function() {
            document.getElementById('menuForm').classList.add('active');
            document.getElementById('formTitle').textContent = 'Tambah Menu Baru';
            editingMenuId = null;
            
            // Clear form
            document.getElementById('menuName').value = '';
            document.getElementById('menuPrice').value = '';
            document.getElementById('menuDescription').value = '';
            document.getElementById('menuImage').value = '';
        });
        
        document.getElementById('cancelMenuBtn').addEventListener('click', function() {
            document.getElementById('menuForm').classList.remove('active');
            editingMenuId = null;
        });
        
        document.getElementById('saveMenuBtn').addEventListener('click', function() {
            const name = document.getElementById('menuName').value.trim();
            const price = parseInt(document.getElementById('menuPrice').value);
            const description = document.getElementById('menuDescription').value.trim();
            const image = document.getElementById('menuImage').value.trim();
            
            if (!name || !price) {
                alert('Nama dan harga menu wajib diisi!');
                return;
            }
            
            const menuItem = {
                nama: name,
                harga: price,
                deskripsi: description,
                gambar: image || 'https://via.placeholder.com/300x200?text=Lapak Inayah'
            };
            
            if (editingMenuId !== null) {
                // Update existing menu
                const newMenu = [...menu];
                newMenu[editingMenuId] = menuItem;
                
                database.ref('Lapak Inayah/menu').set(newMenu)
                    .then(() => {
                        alert('Menu berhasil diperbarui!');
                        document.getElementById('menuForm').classList.remove('active');
                        editingMenuId = null;
                    });
            } else {
                // Add new menu
                const newMenu = [...menu, menuItem];
                
                database.ref('Lapak Inayah/menu').set(newMenu)
                    .then(() => {
                        alert('Menu berhasil ditambahkan!');
                        document.getElementById('menuForm').classList.remove('active');
                    });
            }
        });
        
        function editMenu(index) {
            const item = menu[index];
            if (!item) return;
            
            editingMenuId = index;
            document.getElementById('menuForm').classList.add('active');
            document.getElementById('formTitle').textContent = 'Edit Menu';
            
            document.getElementById('menuName').value = item.nama || '';
            document.getElementById('menuPrice').value = item.harga || '';
            document.getElementById('menuDescription').value = item.deskripsi || '';
            document.getElementById('menuImage').value = item.gambar || '';
        }
        
        function deleteMenu(index) {
            if (!confirm('Apakah Anda yakin ingin menghapus menu ini?')) return;
            
            const newMenu = [...menu];
            newMenu.splice(index, 1);
            
            database.ref('Lapak Inayah/menu').set(newMenu)
                .then(() => {
                    alert('Menu berhasil dihapus!');
                });
        }
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update active tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId + 'Tab').classList.add('active');
            });
        });
        
        // Helper function
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
        
        // Initialize
        window.onload = function() {
            loadOrders();
            loadMenu();
            
            // Simple authentication check (you should implement proper auth)
            const isAdmin = localStorage.getItem('Lapak Inayah_admin');
            if (!isAdmin) {
                const password = prompt('Masukkan password admin:');
                if (password === 'LapakInayah123') { // Change this to your actual password
                    localStorage.setItem('Lapak Inayah_admin', 'true');
                } else {
                    alert('Akses ditolak!');
                    window.location.href = 'index.html';
                }
            }
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('Lapak Inayah_admin');
                window.location.href = 'index.html';
            });
        };
    </script>
</body>
</html>
