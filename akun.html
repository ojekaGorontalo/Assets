<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Akun Driver - JeGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    :root {
      --primary: #1e6f5c;
      --secondary: #289672;
      --accent: #e6dd3b;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --basic: #6c757d;
      --standard: #17a2b8;
      --regular: #28a745;
      --essential: #ffc107;
      --info: #17a2b8;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.4;
      font-size: 0.85rem;
      padding-bottom: 70px;
    }

    /* Header Styles */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .back-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 15px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.85rem;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    .header-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* Container Styles */
    .container {
      max-width: 100%;
      padding: 15px;
    }

    /* Profile Card Styles */
    .profile-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      text-align: center;
    }

    .profile-photo-container {
      position: relative;
      display: inline-block;
      margin-bottom: 15px;
    }

    .profile-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    /* Priority Badge Styles */
    .priority-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      margin: 8px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      letter-spacing: 0.5px;
    }

    .priority-basic {
      background: linear-gradient(135deg, var(--basic), #5a6268);
      color: white;
      border: 2px solid #5a6268;
    }

    .priority-standard {
      background: linear-gradient(135deg, var(--standard), #138496);
      color: white;
      border: 2px solid #138496;
    }

    .priority-regular {
      background: linear-gradient(135deg, var(--regular), #1e7e34);
      color: white;
      border: 2px solid #1e7e34;
    }

    .priority-essential {
      background: linear-gradient(135deg, var(--essential), #e0a800);
      color: #333;
      border: 2px solid #e0a800;
      font-weight: 800;
    }

    /* Priority Badge Small (di foto profil) */
    #priorityBadgeSmall {
      position: absolute;
      bottom: 0px;
      right: 0px;
      padding: 4px 10px;
      font-size: 0.7rem;
      border-radius: 12px;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    .profile-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .profile-vehicle {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    /* Balance Styles */
    .balance-container {
      background: linear-gradient(135deg, var(--info), #138496);
      color: white;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .balance-label {
      font-size: 0.85rem;
      margin-bottom: 5px;
      opacity: 0.9;
    }

    .balance-amount {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .commission-info {
      font-size: 0.75rem;
      opacity: 0.9;
      margin-top: 5px;
    }

    /* Rating Styles */
    .profile-rating {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    .profile-rating:hover {
      background-color: rgba(255, 193, 7, 0.1);
    }

    .rating-stars {
      display: flex;
      gap: 2px;
    }

    .star {
      color: #ddd;
      font-size: 1.1rem;
    }

    .star.filled {
      color: #ffc107;
    }

    .rating-value {
      font-weight: 600;
      color: var(--dark);
    }

    .rating-count {
      color: #666;
      font-size: 0.8rem;
    }

    .profile-stats {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    .stat-item:hover {
      background-color: rgba(30, 111, 92, 0.05);
    }

    .stat-value {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.75rem;
      color: #666;
      margin-top: 2px;
    }

    /* Info Card Styles */
    .info-cards-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (min-width: 768px) {
      .info-cards-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .info-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: background 0.3s;
    }

    .toggle-btn:hover {
      background: rgba(30, 111, 92, 0.1);
    }

    .card-content {
      transition: all 0.3s ease;
    }

    .card-content.collapsed {
      display: none;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 600;
      color: #555;
      font-size: 0.85rem;
    }

    .info-value {
      color: #333;
      text-align: right;
      font-size: 0.85rem;
      max-width: 60%;
      word-break: break-word;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .btn {
      padding: 14px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-info {
      background: var(--info);
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 8px 0;
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 8px;
      margin: 0 5px;
    }

    .nav-item.active {
      background-color: rgba(30, 111, 92, 0.1);
    }

    .nav-item.active .nav-icon {
      color: var(--primary);
    }

    .nav-item.active .nav-label {
      color: var(--primary);
      font-weight: 600;
    }

    .nav-icon {
      font-size: 1.2rem;
      margin-bottom: 4px;
      color: #666;
      transition: all 0.2s;
    }

    .nav-label {
      font-size: 0.7rem;
      color: #666;
      transition: all 0.2s;
    }

    .nav-badge {
      position: absolute;
      top: 0;
      right: 20%;
      background-color: var(--danger);
      color: white;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      font-size: 0.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Loading spinner */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .error-message {
      color: var(--danger);
      margin: 10px 0;
    }

    /* Popup Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .popup-content {
      background: white;
      border-radius: 12px;
      padding: 25px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      animation: popup-appear 0.3s ease-out;
    }

    @keyframes popup-appear {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .popup-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .popup-message {
      color: #555;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .popup-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .popup-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 80px;
    }

    .popup-btn-cancel {
      background: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }

    .popup-btn-confirm {
      background: var(--danger);
      color: white;
    }

    .popup-btn-info {
      background: var(--info);
      color: white;
    }

    .popup-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        font-size: 0.8rem;
      }
      
      .profile-card {
        padding: 15px;
      }
      
      .profile-photo {
        width: 100px;
        height: 100px;
      }
      
      .info-card {
        padding: 15px;
      }
      
      .btn {
        padding: 12px;
        font-size: 0.85rem;
      }
      
      .balance-amount {
        font-size: 1.3rem;
      }
      
      .popup-content {
        padding: 20px;
      }
    }

    @media (max-width: 576px) {
      .container {
        padding: 10px;
      }
      
      .info-item {
        flex-direction: column;
        gap: 5px;
      }
      
      .info-value {
        text-align: left;
        max-width: 100%;
      }
      
      .profile-stats {
        flex-direction: column;
        gap: 10px;
      }
      
      .popup-buttons {
        flex-direction: column;
      }
      
      .popup-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo-container">
      <button class="back-btn" id="backBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
    </div>
    <div class="header-title">Driver JeGo</div>
    <div style="width: 80px;"></div>
  </div>

  <!-- Container -->
  <div class="container" id="mainContainer">
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-photo-container">
        <img id="profilePhoto" class="profile-photo" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Foto Profil">
        <!-- Badge Level Prioritas di foto profil -->
        <div class="priority-badge priority-basic" id="priorityBadgeSmall">Basic</div>
      </div>
      <div class="profile-name" id="profileName">-</div>
      <div class="profile-vehicle" id="profileVehicle">-</div>
      
      <!-- Balance Display -->
      <div class="balance-container">
        <div class="balance-label">Saldo Deposit</div>
        <div class="balance-amount" id="balanceAmount">Rp 0</div>
        <div class="commission-info">Komisi: <span id="commissionRate">0%</span></div>
      </div>
      
      <!-- Rating Display - Clickable -->
      <div class="profile-rating" id="ratingClickable">
        <div class="rating-stars" id="ratingStars"></div>
        <div class="rating-value" id="ratingValue">0.0</div>
        <div class="rating-count" id="ratingCount">(0 rating)</div>
      </div>
      
      <div class="profile-stats">
        <!-- Hanya menyisakan pendapatan hari ini -->
        <div class="stat-item" id="todayEarningsStat">
          <div class="stat-value" id="todayEarnings">Rp 0</div>
          <div class="stat-label">Pendapatan Hari Ini</div>
        </div>
      </div>
    </div>

    <!-- Container untuk kartu informasi -->
    <div class="info-cards-container">
      <!-- Informasi Pribadi -->
      <div class="info-card">
        <div class="card-header">
          <div class="card-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Informasi Pribadi
          </div>
          <button class="toggle-btn" data-target="personalInfo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
        </div>
        <div class="card-content" id="personalInfo">
          <div class="info-item">
            <div class="info-label">Nama Lengkap</div>
            <div class="info-value" id="fullName">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="email">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">No. Telepon</div>
            <div class="info-value" id="phoneNumber">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Alamat</div>
            <div class="info-value" id="address">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">No. KTP</div>
            <div class="info-value" id="idCardNumber">-</div>
          </div>
        </div>
      </div>

      <!-- Informasi Kendaraan -->
      <div class="info-card">
        <div class="card-header">
          <div class="card-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="7" cy="17" r="2"></circle>
              <circle cx="17" cy="17" r="2"></circle>
              <path d="M5 17H3v-6l2-5h9l4 5h3v6h-2m-8 0H9m4 0h2"></path>
            </svg>
            Informasi Kendaraan
          </div>
          <button class="toggle-btn" data-target="vehicleInfo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
        </div>
        <div class="card-content" id="vehicleInfo">
          <div class="info-item">
            <div class="info-label">Jenis Kendaraan</div>
            <div class="info-value" id="vehicleType">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Merek Kendaraan</div>
            <div class="info-value" id="vehicleBrand">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Plat Nomor</div>
            <div class="info-value" id="plateNumber">-</div>
          </div>
        </div>
      </div>

      <!-- Informasi Akun -->
      <div class="info-card">
        <div class="card-header">
          <div class="card-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Informasi Akun
          </div>
          <button class="toggle-btn" data-target="accountInfo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
        </div>
        <div class="card-content" id="accountInfo">
          <div class="info-item">
            <div class="info-label">ID Driver</div>
            <div class="info-value" id="driverId">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Tanggal Daftar</div>
            <div class="info-value" id="registrationDate">-</div>
          </div>
          
          <div class="info-item">
            <div class="info-label">Status Verifikasi</div>
            <div class="info-value" id="verificationStatus">-</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-danger" id="logoutBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16,17 21,12 16,7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Keluar
      </button>
    </div>
  </div>

  <!-- Popup Konfirmasi Logout -->
  <div class="popup-overlay" id="logoutPopup" style="display: none;">
    <div class="popup-content">
      <div class="popup-title">Konfirmasi Keluar</div>
      <div class="popup-message">Apakah Anda yakin ingin keluar dari akun driver JeGo?</div>
      <div class="popup-buttons">
        <button class="popup-btn popup-btn-cancel" id="cancelLogoutBtn">Batal</button>
        <button class="popup-btn popup-btn-confirm" id="confirmLogoutBtn">Ya, Keluar</button>
      </div>
    </div>
  </div>

  <!-- Popup Informasi -->
  <div class="popup-overlay" id="infoPopup" style="display: none;">
    <div class="popup-content">
      <div class="popup-title" id="infoPopupTitle">Informasi</div>
      <div class="popup-message" id="infoPopupMessage"></div>
      <div class="popup-buttons">
        <button class="popup-btn popup-btn-info" id="closeInfoPopupBtn">Tutup</button>
      </div>
    </div>
  </div>

  <script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCYDUjYzdG3_xBxWdGV2wk1E-mBu21pzvg",
    authDomain: "ojeka-ba255.firebaseapp.com",
    databaseURL: "https://ojeka-ba255-default-rtdb.firebaseio.com",
    projectId: "ojeka-ba255",
    storageBucket: "ojeka-ba255.firebasestorage.app",
    messagingSenderId: "639980533353",
    appId: "1:639980533353:web:14a9cde94065b60c8cd4f8",
    measurementId: "G-PBP64Z8VQ8"
  };

  // Initialize Firebase
  let database;
  let isFirebaseInitialized = false;

  try {
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    isFirebaseInitialized = true;
    console.log('‚úÖ Firebase berhasil diinisialisasi');
  } catch (error) {
    console.error('‚ùå Error inisialisasi Firebase:', error);
    isFirebaseInitialized = false;
  }

  // Variabel global
  let currentDriverData = null;
  let retryCount = 0;
  const MAX_RETRIES = 3;
  let driverOrders = [];
  let driverRatings = [];

  // ==================== FUNGSI POPUP ====================
  
  // Fungsi untuk menampilkan popup konfirmasi logout
  function showLogoutPopup() {
    const logoutPopup = document.getElementById('logoutPopup');
    if (logoutPopup) {
      logoutPopup.style.display = 'flex';
    }
  }

  // Fungsi untuk menyembunyikan popup konfirmasi logout
  function hideLogoutPopup() {
    const logoutPopup = document.getElementById('logoutPopup');
    if (logoutPopup) {
      logoutPopup.style.display = 'none';
    }
  }

  // Fungsi untuk menampilkan popup informasi
  function showInfoPopup(title, message) {
    const infoPopup = document.getElementById('infoPopup');
    const infoPopupTitle = document.getElementById('infoPopupTitle');
    const infoPopupMessage = document.getElementById('infoPopupMessage');
    
    if (infoPopup && infoPopupTitle && infoPopupMessage) {
      infoPopupTitle.textContent = title;
      infoPopupMessage.textContent = message;
      infoPopup.style.display = 'flex';
    }
  }

  // Fungsi untuk menyembunyikan popup informasi
  function hideInfoPopup() {
    const infoPopup = document.getElementById('infoPopup');
    if (infoPopup) {
      infoPopup.style.display = 'none';
    }
  }

  // ==================== FUNGSI RESTORE UI ====================
  function restoreMainUI() {
    const container = document.getElementById('mainContainer');
    
    // Kembalikan struktur UI asli akun.html dengan pembaruan
    container.innerHTML = `
      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-photo-container">
          <img id="profilePhoto" class="profile-photo" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Foto Profil">
          <!-- Badge Level Prioritas di foto profil -->
          <div class="priority-badge priority-basic" id="priorityBadgeSmall">Basic</div>
        </div>
        <div class="profile-name" id="profileName">-</div>
        <div class="profile-vehicle" id="profileVehicle">-</div>
        
        <!-- Balance Display -->
        <div class="balance-container">
          <div class="balance-label">Saldo Deposit</div>
          <div class="balance-amount" id="balanceAmount">Rp 0</div>
          <div class="commission-info">Komisi: <span id="commissionRate">0%</span></div>
        </div>
        
        <!-- Rating Display - Clickable -->
        <div class="profile-rating" id="ratingClickable">
          <div class="rating-stars" id="ratingStars"></div>
          <div class="rating-value" id="ratingValue">0.0</div>
          <div class="rating-count" id="ratingCount">(0 rating)</div>
        </div>
        
        <div class="profile-stats">
          <!-- Hanya menyisakan pendapatan hari ini -->
          <div class="stat-item" id="todayEarningsStat">
            <div class="stat-value" id="todayEarnings">Rp 0</div>
            <div class="stat-label">Pendapatan Hari Ini</div>
          </div>
        </div>
      </div>

      <!-- Container untuk kartu informasi -->
      <div class="info-cards-container">
        <!-- Informasi Pribadi -->
        <div class="info-card">
          <div class="card-header">
            <div class="card-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Informasi Pribadi
            </div>
            <button class="toggle-btn" data-target="personalInfo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
          </div>
          <div class="card-content" id="personalInfo">
            <div class="info-item">
              <div class="info-label">Nama Lengkap</div>
              <div class="info-value" id="fullName">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Email</div>
              <div class="info-value" id="email">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">No. Telepon</div>
              <div class="info-value" id="phoneNumber">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Alamat</div>
              <div class="info-value" id="address">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">No. KTP</div>
              <div class="info-value" id="idCardNumber">-</div>
            </div>
          </div>
        </div>

        <!-- Informasi Kendaraan -->
        <div class="info-card">
          <div class="card-header">
            <div class="card-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="7" cy="17" r="2"></circle>
                <circle cx="17" cy="17" r="2"></circle>
                <path d="M5 17H3v-6l2-5h9l4 5h3v6h-2m-8 0H9m4 0h2"></path>
              </svg>
              Informasi Kendaraan
            </div>
            <button class="toggle-btn" data-target="vehicleInfo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
          </div>
          <div class="card-content" id="vehicleInfo">
            <div class="info-item">
              <div class="info-label">Jenis Kendaraan</div>
              <div class="info-value" id="vehicleType">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Merek Kendaraan</div>
              <div class="info-value" id="vehicleBrand">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Plat Nomor</div>
              <div class="info-value" id="plateNumber">-</div>
            </div>
          </div>
        </div>

        <!-- Informasi Akun -->
        <div class="info-card">
          <div class="card-header">
            <div class="card-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              Informasi Akun
            </div>
            <button class="toggle-btn" data-target="accountInfo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
          </div>
          <div class="card-content" id="accountInfo">
            <div class="info-item">
              <div class="info-label">ID Driver</div>
              <div class="info-value" id="driverId">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Tanggal Daftar</div>
              <div class="info-value" id="registrationDate">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Status Verifikasi</div>
              <div class="info-value" id="verificationStatus">-</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn btn-danger" id="logoutBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16,17 21,12 16,7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Keluar
        </button>
      </div>
    `;
    
    console.log('‚úÖ UI asli berhasil direstore');
    
    // Inisialisasi ulang tombol setelah UI direstore
    initButtons();
    
    // Update badge prioritas jika data sudah dimuat
    if (driverRatings && driverRatings.length > 0) {
      const avgRating = calculateAverageRating(driverRatings);
      updatePriorityBadge(avgRating);
    }
  }

  // ==================== FUNGSI UTAMA ====================

  // Fungsi untuk memuat data driver dari Firebase
  function loadDriverData() {
    // Cek apakah driver sudah login
    const driverData = getDriverDataFromStorage();
    
    if (!driverData || !driverData.driverId) {
      console.error('‚ùå Driver belum login atau data tidak valid');
      showErrorState('Anda belum login. Silakan login terlebih dahulu.');
      return;
    }

    // Cek koneksi Firebase
    if (!isFirebaseInitialized || !database) {
      console.error('‚ùå Firebase tidak terinisialisasi');
      showErrorState('Koneksi database gagal. Periksa koneksi internet.');
      return;
    }

    const driverId = driverData.driverId;
    console.log('üîÑ Memuat data driver:', driverId);

    // Tampilkan loading state
    showLoadingState();

    // Ambil data driver dari Firebase
    const driverRef = database.ref('drivers/' + driverId);
    
    driverRef.once('value')
      .then((snapshot) => {
        const driverData = snapshot.val();
        
        if (driverData) {
          console.log('‚úÖ Data driver berhasil dimuat:', driverData);
          currentDriverData = driverData;
          
          // Update localStorage dengan data terbaru
          updateDriverDataInStorage(driverData);
          
          // Restore UI sebelum menampilkan data
          restoreMainUI();
          
          // Tampilkan data di UI
          displayDriverData(driverData);
          
          // Muat data balance deposit dan potongan komisi
          loadBalanceAndCommission(driverId);
          
          // Muat data ratings untuk perhitungan yang akurat
          loadDriverRatings(driverId);
          
          // Muat data orders untuk statistik
          loadDriverOrders(driverId);
          
          retryCount = 0; // Reset retry count jika berhasil
        } else {
          console.error('‚ùå Data driver tidak ditemukan di Firebase');
          showErrorState('Data driver tidak ditemukan. Silakan coba lagi.');
        }
      })
      .catch((error) => {
        console.error('‚ùå Error memuat data driver:', error);
        retryCount++;
        
        if (retryCount <= MAX_RETRIES) {
          console.log(`üîÑ Mencoba ulang... (${retryCount}/${MAX_RETRIES})`);
          setTimeout(loadDriverData, 2000); // Retry after 2 seconds
        } else {
          showErrorState('Gagal memuat data driver. Periksa koneksi internet Anda.');
        }
      });
  }

  // PERUBAHAN: Fungsi untuk memuat data balance deposit dan potongan komisi dari Firebase
  function loadBalanceAndCommission(driverId) {
    if (!isFirebaseInitialized || !database) {
      console.error('‚ùå Firebase tidak terinisialisasi');
      return;
    }

    console.log('üîÑ Memuat data balance deposit dan potongan komisi untuk driver:', driverId);

    // Ambil data balance deposit dan potongan komisi dari Firebase
    const balanceRef = database.ref('drivers/' + driverId + '/Balance');
    const potonganRef = database.ref('drivers/' + driverId + '/Potongan');
    
    Promise.all([
      balanceRef.once('value'),
      potonganRef.once('value')
    ])
    .then(([balanceSnapshot, potonganSnapshot]) => {
      const balance = balanceSnapshot.val() || 0;
      const potonganRate = potonganSnapshot.val() || 0;
      
      console.log('‚úÖ Data balance deposit dan potongan komisi berhasil dimuat:', {
        balance: balance,
        potonganRate: potonganRate
      });
      
      // Update UI dengan data balance dan potongan komisi
      updateBalanceDisplay(balance, potonganRate);
    })
    .catch((error) => {
      console.error('‚ùå Error memuat data balance dan potongan komisi:', error);
      // Tetap update UI dengan nilai default
      updateBalanceDisplay(0, 0);
    });
  }

  // Fungsi untuk update tampilan balance dan potongan komisi
  function updateBalanceDisplay(balance, potonganRate) {
    const balanceAmount = document.getElementById('balanceAmount');
    const commissionRateElement = document.getElementById('commissionRate');
    
    if (balanceAmount) {
      balanceAmount.textContent = formatCurrency(balance);
    }
    
    if (commissionRateElement) {
      commissionRateElement.textContent = potonganRate + '%';
    }
  }

  // Fungsi untuk memuat data ratings driver
  function loadDriverRatings(driverId) {
    if (!isFirebaseInitialized || !database) {
      console.error('‚ùå Firebase tidak terinisialisasi');
      return;
    }

    console.log('üîÑ Memuat data ratings untuk driver:', driverId);

    const ratingsRef = database.ref('drivers/' + driverId + '/ratings');
    
    ratingsRef.once('value')
      .then((snapshot) => {
        const ratingsData = snapshot.val();
        driverRatings = [];
        
        if (ratingsData) {
          // Konversi object menjadi array dan tambahkan key sebagai id
          Object.keys(ratingsData).forEach(key => {
            const rating = ratingsData[key];
            driverRatings.push({
              id: key,
              ...rating
            });
          });
          
          console.log(`‚úÖ ${driverRatings.length} ratings berhasil dimuat`);
          
          // Update rating display dengan perhitungan real-time
          updateRatingDisplay();
          
          // Update badge prioritas berdasarkan perhitungan real-time
          const avgRating = calculateAverageRating(driverRatings);
          updatePriorityBadge(avgRating);
        } else {
          console.log('‚ùå Tidak ada data ratings ditemukan');
          updateRatingDisplay();
        }
      })
      .catch((error) => {
        console.error('‚ùå Error memuat data ratings:', error);
        updateRatingDisplay();
      });
  }

  // Fungsi untuk memuat data orders driver
  function loadDriverOrders(driverId) {
    if (!isFirebaseInitialized || !database) {
      console.error('‚ùå Firebase tidak terinisialisasi');
      return;
    }

    console.log('üîÑ Memuat data orders untuk driver:', driverId);

    const ordersRef = database.ref('orders');
    
    ordersRef.once('value')
      .then((snapshot) => {
        const ordersData = snapshot.val();
        driverOrders = [];
        
        if (ordersData) {
          // Filter orders yang dimiliki oleh driver ini
          Object.values(ordersData).forEach(order => {
            if (order.selected_driver && order.selected_driver.driver_id === driverId) {
              driverOrders.push(order);
            }
          });
          
          console.log(`‚úÖ ${driverOrders.length} orders berhasil dimuat`);
          
          // Update statistik pendapatan hari ini
          updateTodayEarnings();
        } else {
          console.log('‚ùå Tidak ada data orders ditemukan');
          updateTodayEarnings();
        }
      })
      .catch((error) => {
        console.error('‚ùå Error memuat data orders:', error);
        updateTodayEarnings();
      });
  }

  // Fungsi untuk menghitung rata-rata rating dari data ratings individual
  function calculateAverageRating(ratings) {
    if (!ratings || ratings.length === 0) {
      return 0;
    }
    
    const totalRating = ratings.reduce((sum, rating) => sum + (rating.rating || 0), 0);
    return totalRating / ratings.length;
  }

  // Fungsi untuk update tampilan rating
  function updateRatingDisplay() {
    const avgRating = calculateAverageRating(driverRatings);
    const ratingCount = driverRatings.length;
    
    // Update rating stars
    const ratingStars = document.getElementById('ratingStars');
    if (ratingStars) ratingStars.innerHTML = generateStarRating(avgRating);
    
    // Update rating value
    const ratingValue = document.getElementById('ratingValue');
    if (ratingValue) ratingValue.textContent = avgRating.toFixed(1);
    
    // Update rating count
    const ratingCountElement = document.getElementById('ratingCount');
    if (ratingCountElement) ratingCountElement.textContent = `(${ratingCount} rating)`;
  }

  // Fungsi untuk update pendapatan hari ini - VERSI WITA
  function updateTodayEarnings() {
    if (!driverOrders || driverOrders.length === 0) {
        document.getElementById('todayEarnings').textContent = 'Rp 0';
        return;
    }

    // Dapatkan tanggal hari ini dalam format YYYY-MM-DD untuk WITA
    const now = new Date();
    const todayWITA = new Date(now.getTime() + (8 * 60 * 60 * 1000)); // Convert ke WITA (UTC+8)
    const todayDateString = todayWITA.toISOString().split('T')[0]; // YYYY-MM-DD

    console.log('üîÑ Filtering orders for today (WITA):', {
        todayWITA: todayDateString,
        totalOrders: driverOrders.length
    });

    const todayOrders = driverOrders.filter(order => {
        if (!order.completed_at) {
            return false;
        }
        
        try {
            // Convert order date ke WITA dan ambil tanggalnya
            const orderDate = new Date(order.completed_at);
            const orderDateWITA = new Date(orderDate.getTime() + (8 * 60 * 60 * 1000));
            const orderDateString = orderDateWITA.toISOString().split('T')[0];
            
            const isToday = orderDateString === todayDateString;
            
            if (isToday) {
                console.log('‚úÖ Order included:', {
                    order_id: order.order_id,
                    completed_at: order.completed_at,
                    order_date_wita: orderDateString,
                    harga_total: order.harga_total
                });
            }
            
            return isToday;
        } catch (error) {
            console.error('Error parsing order date:', error, order);
            return false;
        }
    });

    console.log(`üìà Found ${todayOrders.length} orders for today in WITA`);

    // Hitung total pendapatan hari ini
    const todayEarnings = todayOrders.reduce((sum, order) => {
        const earnings = parseInt(order.harga_total) || 0;
        return sum + earnings;
    }, 0);

    console.log(`üí∞ Total earnings today (WITA): Rp ${todayEarnings}`);

    // Update UI
    document.getElementById('todayEarnings').textContent = formatCurrency(todayEarnings);
  }

  // Fungsi untuk mendapatkan data driver dari localStorage
  function getDriverDataFromStorage() {
    try {
      return JSON.parse(localStorage.getItem('jego_driver_data') || '{}');
    } catch (error) {
      console.error('‚ùå Error parsing driver data from storage:', error);
      return {};
    }
  }

  // Fungsi untuk update data driver di localStorage
  function updateDriverDataInStorage(data) {
    try {
      const currentData = getDriverDataFromStorage();
      const updatedData = { ...currentData, ...data };
      localStorage.setItem('jego_driver_data', JSON.stringify(updatedData));
      console.log('‚úÖ Data driver diupdate di localStorage');
    } catch (error) {
      console.error('‚ùå Error updating driver data in storage:', error);
    }
  }

  // Fungsi untuk menampilkan data driver di UI dengan safe default values
  function displayDriverData(data) {
    if (!data) {
      console.error('‚ùå Data driver tidak valid untuk ditampilkan');
      return;
    }

    // Safe data dengan default values
    const safeData = {
      fullName: data.fullName || '-',
      email: data.email || '-',
      phoneNumber: data.phoneNumber || '-',
      address: data.address || '-',
      idCardNumber: data.idCardNumber || '-',
      vehicleType: data.vehicleType || '-',
      vehicleBrand: data.vehicleBrand || '-',
      plateNumber: data.plateNumber || '-',
      driverId: data.driverId || '-',
      status: data.status || 'pending',
      profilePhotoUrl: data.profilePhotoUrl || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
      registrationDate: data.registrationDate || null
    };

    // Foto profil dengan error handling
    const profilePhoto = document.getElementById('profilePhoto');
    if (profilePhoto && safeData.profilePhotoUrl) {
      profilePhoto.src = safeData.profilePhotoUrl;
      // Handle error loading image
      profilePhoto.onerror = function() {
        if (profilePhoto) {
          profilePhoto.src = 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
        }
      };
    }

    // Nama dan kendaraan
    const profileName = document.getElementById('profileName');
    const profileVehicle = document.getElementById('profileVehicle');
    if (profileName) profileName.textContent = safeData.fullName;
    if (profileVehicle) profileVehicle.textContent = `${getVehicleTypeText(safeData.vehicleType)} - ${safeData.vehicleBrand}`;

    // Informasi pribadi
    const fullName = document.getElementById('fullName');
    const email = document.getElementById('email');
    const phoneNumber = document.getElementById('phoneNumber');
    const address = document.getElementById('address');
    const idCardNumber = document.getElementById('idCardNumber');
    
    if (fullName) fullName.textContent = safeData.fullName;
    if (email) email.textContent = safeData.email;
    if (phoneNumber) phoneNumber.textContent = safeData.phoneNumber;
    if (address) address.textContent = safeData.address;
    if (idCardNumber) idCardNumber.textContent = maskIdCard(safeData.idCardNumber);

    // Informasi kendaraan
    const vehicleType = document.getElementById('vehicleType');
    const vehicleBrand = document.getElementById('vehicleBrand');
    const plateNumber = document.getElementById('plateNumber');
    
    if (vehicleType) vehicleType.textContent = getVehicleTypeText(safeData.vehicleType);
    if (vehicleBrand) vehicleBrand.textContent = safeData.vehicleBrand;
    if (plateNumber) plateNumber.textContent = safeData.plateNumber;

    // Informasi akun
    const driverId = document.getElementById('driverId');
    const registrationDate = document.getElementById('registrationDate');
    const verificationStatus = document.getElementById('verificationStatus');
    
    if (driverId) driverId.textContent = safeData.driverId;
    if (registrationDate) registrationDate.textContent = formatDate(safeData.registrationDate);
    if (verificationStatus) verificationStatus.textContent = getStatusText(safeData.status);
  }

  // ==================== FUNGSI PRIORITAS BERDASARKAN RATING ====================

  // Fungsi untuk menentukan badge prioritas berdasarkan rating
  function getPriorityBadge(rating) {
    if (rating >= 4.5) {
      return { level: 'Essential', class: 'priority-essential' };
    } else if (rating >= 4.0) {
      return { level: 'Regular', class: 'priority-regular' };
    } else if (rating >= 3.0) {
      return { level: 'Standard', class: 'priority-standard' };
    } else {
      return { level: 'Basic', class: 'priority-basic' };
    }
  }

  // Fungsi untuk update badge prioritas
  function updatePriorityBadge(rating) {
    const priority = getPriorityBadge(rating);
    
    // Update badge kecil di foto profil
    const priorityBadgeSmall = document.getElementById('priorityBadgeSmall');
    if (priorityBadgeSmall) {
      priorityBadgeSmall.textContent = priority.level;
      priorityBadgeSmall.className = `priority-badge ${priority.class}`;
    }
  }

  // ==================== FUNGSI BANTUAN ====================

  // Fungsi untuk menyembunyikan sebagian nomor KTP
  function maskIdCard(idCard) {
    if (!idCard || idCard === '-') return '-';
    
    const idString = idCard.toString();
    if (idString.length <= 8) {
      return idString; // Tidak perlu disembunyikan jika terlalu pendek
    }
    
    const firstPart = idString.substring(0, 4);
    const lastPart = idString.substring(idString.length - 4);
    const maskedPart = '*'.repeat(idString.length - 8);
    
    return firstPart + maskedPart + lastPart;
  }

  // Fungsi untuk menghasilkan bintang rating
  function generateStarRating(rating, starClass = 'star') {
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;
    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
    
    let starsHTML = '';
    
    // Bintang penuh
    for (let i = 0; i < fullStars; i++) {
      starsHTML += `<span class="${starClass} filled">‚òÖ</span>`;
    }
    
    // Bintang setengah (jika ada)
    if (hasHalfStar) {
      starsHTML += `<span class="${starClass} filled">‚òÖ</span>`;
    }
    
    // Bintang kosong
    for (let i = 0; i < emptyStars; i++) {
      starsHTML += `<span class="${starClass}">‚òÜ</span>`;
    }
    
    return starsHTML;
  }

  // Fungsi untuk mendapatkan teks status
  function getStatusText(status) {
    const statusMap = {
      'accepted': 'Diterima',
      'pending': 'Menunggu',
      'rejected': 'Ditolak'
    };
    return statusMap[status] || status;
  }

  // Fungsi untuk mendapatkan class status
  function getStatusClass(status) {
    const classMap = {
      'accepted': 'status-accepted',
      'pending': 'status-pending',
      'rejected': 'status-rejected'
    };
    return classMap[status] || 'status-pending';
  }

  // Fungsi untuk mendapatkan teks jenis kendaraan
  function getVehicleTypeText(vehicleType) {
    const vehicleMap = {
      'motor': 'Motor',
      'bentor': 'Bentor',
      'mobil': 'Mobil',
      'kurir_motor': 'Kurir Motor',
      'kurir_bentor': 'Kurir Bentor'
    };
    return vehicleMap[vehicleType] || vehicleType;
  }

  // Fungsi untuk memformat tanggal dengan error handling
  function formatDate(dateString) {
    if (!dateString) return '-';
    
    try {
      const date = new Date(dateString);
      if (isNaN(date.getTime())) {
        return '-';
      }
      
      return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'short',
        year: 'numeric'
      });
    } catch (error) {
      console.error('Error formatting date:', error);
      return '-';
    }
  }

  // Fungsi untuk memformat mata uang
  function formatCurrency(amount) {
    if (!amount && amount !== 0) return 'Rp 0';
    
    try {
      return 'Rp ' + parseInt(amount).toLocaleString('id-ID');
    } catch (error) {
      console.error('Error formatting currency:', error);
      return 'Rp 0';
    }
  }

  // ==================== FUNGSI UI STATES ====================

  // Fungsi untuk menampilkan state loading
  function showLoadingState() {
    const container = document.getElementById('mainContainer');
    container.innerHTML = `
      <div class="loading">
        <div class="spinner"></div>
        <div style="margin-left: 15px;">Memuat data driver...</div>
      </div>
    `;
  }

  // Fungsi untuk menampilkan state error
  function showErrorState(message) {
    const container = document.getElementById('mainContainer');
    container.innerHTML = `
      <div class="empty-state">
        <div style="font-size: 3rem;">‚ö†Ô∏è</div>
        <div class="error-message">${message}</div>
        <p>Silakan coba lagi atau periksa koneksi internet Anda.</p>
        <button class="btn btn-primary" id="retryBtn" style="margin-top: 15px;">
          Coba Lagi
        </button>
      </div>
    `;
    
    const retryBtn = document.getElementById('retryBtn');
    if (retryBtn) {
      retryBtn.addEventListener('click', function () {
        retryCount = 0;
        loadDriverData();
      });
    }
  }

  // ==================== FUNGSI INISIALISASI TOMBOL ====================

  // Fungsi untuk menginisialisasi semua event listener tombol
  function initButtons() {
    console.log('üîÑ Menginisialisasi tombol...');
    
    // Event listeners untuk tombol utama
    const backBtn = document.getElementById('backBtn');
    if (backBtn) {
      backBtn.addEventListener('click', goBack);
      console.log('‚úÖ Tombol kembali diinisialisasi');
    }

    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', showLogoutPopup);
      console.log('‚úÖ Tombol logout diinisialisasi');
    }
    
    // PERUBAHAN: Event listener untuk rating - redirect ke penilaianLayanan.html
    const ratingClickable = document.getElementById('ratingClickable');
    if (ratingClickable) {
      ratingClickable.addEventListener('click', function() {
        window.location.href = 'penilaianLayanan.html';
      });
      console.log('‚úÖ Area rating diinisialisasi (redirect ke penilaianLayanan.html)');
    }

    // PERUBAHAN: Event listener untuk pendapatan hari ini - redirect ke pendapatan.html
    const todayEarningsStat = document.getElementById('todayEarningsStat');
    if (todayEarningsStat) {
      todayEarningsStat.addEventListener('click', function() {
        window.location.href = 'pendapatan.html';
      });
      console.log('‚úÖ Area pendapatan hari ini diinisialisasi (redirect ke pendapatan.html)');
    }
    
    // Event listeners untuk toggle buttons
    const toggleButtons = document.querySelectorAll('.toggle-btn');
    toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const content = document.getElementById(targetId);
        if (content) {
          content.classList.toggle('collapsed');
          
          // Rotate arrow icon
          const icon = this.querySelector('svg');
          if (icon) {
            icon.style.transform = content.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';
          }
        }
      });
    });
    
    // Event listeners untuk popup logout
    const cancelLogoutBtn = document.getElementById('cancelLogoutBtn');
    const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
    
    if (cancelLogoutBtn) {
      cancelLogoutBtn.addEventListener('click', hideLogoutPopup);
    }
    
    if (confirmLogoutBtn) {
      confirmLogoutBtn.addEventListener('click', logout);
    }
    
    // Event listener untuk popup informasi
    const closeInfoPopupBtn = document.getElementById('closeInfoPopupBtn');
    if (closeInfoPopupBtn) {
      closeInfoPopupBtn.addEventListener('click', hideInfoPopup);
    }
    
    console.log('‚úÖ Semua tombol berhasil diinisialisasi');
  }

  // Fungsi untuk mengirim data ke Kodular
  function sendToKodular(data) {
    console.log('Mengirim data ke Kodular:', data);
    
    if (typeof window.AppInventor !== 'undefined' && window.AppInventor.setWebViewString) {
      try {
        window.AppInventor.setWebViewString(JSON.stringify(data));
        console.log('‚úÖ Data berhasil dikirim ke Kodular via AppInventor');
      } catch (error) {
        console.error('Error mengirim data via AppInventor:', error);
      }
    }
    else if (typeof window.android !== 'undefined' && window.android.receiveData) {
      try {
        window.android.receiveData(JSON.stringify(data));
        console.log('‚úÖ Data berhasil dikirim ke Kodular via window.android');
      } catch (error) {
        console.error('Error mengirim data via window.android:', error);
      }
    }
    else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.observe) {
      try {
        window.webkit.messageHandlers.observe.postMessage(data);
        console.log('‚úÖ Data berhasil dikirim ke Kodular via webkit.messageHandlers');
      } catch (error) {
        console.error('Error mengirim data via webkit.messageHandlers:', error);
      }
    }
    else {
      console.warn('‚ùå Tidak ada metode yang berhasil mengirim data ke Kodular');
    }
  }

  // ==================== EVENT HANDLERS ====================

  // Fungsi untuk kembali ke halaman sebelumnya
  function goBack() {
    sendToKodular({
        action: 'navigate_back'
    });

    window.location.href = "list.html";
  }

  // Fungsi untuk logout
  function logout() {
    // Sembunyikan popup logout
    hideLogoutPopup();
    
    // Hapus data dari localStorage
    localStorage.removeItem('jego_driver_data');
    localStorage.removeItem('jego_driver_location');
    localStorage.removeItem('jego_autobid_enabled');
    localStorage.removeItem('jego_driver_accepted_order');
    
    // Kirim perintah logout ke Kodular
sendToKodular({
  action: 'logout',
  message: 'Driver berhasil logout'
});

// Tampilkan pesan konfirmasi
showInfoPopup('Berhasil Logout', 'Anda telah berhasil keluar dari akun driver JeGo.');

// Tunggu popup tampil dulu, lalu redirect
setTimeout(() => {
  window.location.href = "loginDriver.html";
}, 1200); // delay 1.2 detik
  }
  // ==================== INISIALISASI APLIKASI ====================

  // Inisialisasi saat halaman dimuat
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ Halaman Akun Driver dimuat');
    
    // Inisialisasi tombol pertama kali
    initButtons();
    
    // Muat data driver
    loadDriverData();
  });

  // Handle visibility change (tab menjadi aktif kembali)
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      console.log('üîÑ Halaman menjadi aktif, memuat ulang data...');
      loadDriverData();
    }
  });
  </script>
</body>
</html>
