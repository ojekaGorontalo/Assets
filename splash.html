<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>JeGo - Driver Gorontalo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    :root {
      --primary: #1e6f5c;
      --secondary: #289672;
      --accent: #e6dd3b;
      --light: #f8f9fa;
      --dark: #343a40;
      --gorontalo-blue: #1e4f6f;
      --gorontalo-yellow: #e6b93b;
      --danger: #dc3545;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--gorontalo-blue), var(--primary));
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      overflow: hidden;
      position: relative;
    }

    /* Background pattern dengan motif khas Gorontalo */
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(230, 221, 59, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(30, 111, 92, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 40% 80%, rgba(230, 185, 59, 0.05) 0%, transparent 20%);
      z-index: -1;
    }

    .splash-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      max-width: 90%;
      position: relative;
      z-index: 1;
    }

    .logo-container {
      width: 150px;
      height: 150px;
      margin-bottom: 25px;
      animation: pulse 2s infinite, float 3s ease-in-out infinite;
      position: relative;
    }

    .logo {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
    }

    .app-title {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      background: linear-gradient(to right, #fff, var(--gorontalo-yellow));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .app-subtitle {
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.9;
      max-width: 300px;
      line-height: 1.4;
    }

    .location-badge {
      background-color: rgba(255,255,255,0.15);
      padding: 8px 16px;
      border-radius: 20px;
      margin-bottom: 25px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .loading-container {
      margin-top: 20px;
      width: 200px;
    }

    .loading-bar {
      height: 6px;
      background-color: rgba(255,255,255,0.3);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 10px;
      position: relative;
    }

    .loading-progress {
      height: 100%;
      background: linear-gradient(to right, var(--gorontalo-yellow), var(--accent));
      width: 0%;
      border-radius: 3px;
      transition: width 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .loading-progress::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 20px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
      animation: shimmer 1.5s infinite;
    }

    .loading-text {
      font-size: 0.9rem;
      opacity: 0.8;
      min-height: 20px;
    }

    .driver-badge {
      background-color: rgba(255,255,255,0.1);
      padding: 10px 20px;
      border-radius: 20px;
      margin-top: 25px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .gorontalo-motif {
      position: absolute;
      width: 80px;
      height: 80px;
      opacity: 0.1;
      z-index: 0;
    }

    .motif-1 {
      top: 10%;
      left: 10%;
      background: radial-gradient(circle, var(--gorontalo-yellow) 0%, transparent 70%);
    }

    .motif-2 {
      bottom: 10%;
      right: 10%;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
    }

    /* Status Message Styles */
    .status-message {
      background-color: rgba(255,255,255,0.15);
      padding: 15px 20px;
      border-radius: 10px;
      margin: 20px 0;
      max-width: 400px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.2);
      display: none;
    }

    .status-message.error {
      background-color: rgba(220, 53, 69, 0.2);
      border: 1px solid rgba(220, 53, 69, 0.4);
    }

    .status-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }

    .status-desc {
      font-size: 0.9rem;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
    }

    .primary-btn {
      background-color: var(--primary);
      color: white;
    }

    .secondary-btn {
      background-color: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes float {
      0% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
      100% {
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(400%);
      }
    }

    .fade-in {
      animation: fadeIn 1s ease forwards;
    }

    .delay-1 {
      animation-delay: 0.2s;
      opacity: 0;
    }

    .delay-2 {
      animation-delay: 0.4s;
      opacity: 0;
    }

    .delay-3 {
      animation-delay: 0.6s;
      opacity: 0;
    }

    .delay-4 {
      animation-delay: 0.8s;
      opacity: 0;
    }

    /* Footer dengan informasi copyright */
    .splash-footer {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-size: 0.8rem;
      opacity: 0.7;
    }

    @media (max-width: 768px) {
      .logo-container {
        width: 120px;
        height: 120px;
      }
      
      .app-title {
        font-size: 1.8rem;
      }
      
      .app-subtitle {
        font-size: 1rem;
        margin-bottom: 25px;
      }
      
      .gorontalo-motif {
        width: 60px;
        height: 60px;
      }
    }

    @media (max-width: 576px) {
      .logo-container {
        width: 100px;
        height: 100px;
      }
      
      .app-title {
        font-size: 1.5rem;
      }
      
      .app-subtitle {
        font-size: 0.9rem;
        margin-bottom: 20px;
      }
      
      .location-badge, .driver-badge {
        font-size: 0.8rem;
        padding: 6px 12px;
      }
      
      .gorontalo-motif {
        width: 50px;
        height: 50px;
      }
    }
  </style>
</head>
<body>
  <!-- Motif dekoratif khas Gorontalo -->
  <div class="gorontalo-motif motif-1"></div>
  <div class="gorontalo-motif motif-2"></div>

  <div class="splash-container">
    <div class="logo-container fade-in">
      <img src="https://cdn-icons-png.flaticon.com/128/7890/7890227.png" alt="JeGo Logo" class="logo">
    </div>
    
    <h1 class="app-title fade-in delay-1">JeGo Gorontalo</h1>
    
    <p class="app-subtitle fade-in delay-2">Transportasi online terdepan untuk masyarakat Gorontalo</p>
    
    <div class="location-badge fade-in delay-2">
      <span>üìç</span>
      <span>Gorontalo bisa olo</span>
    </div>
    
    <div class="loading-container fade-in delay-3">
      <div class="loading-bar">
        <div class="loading-progress" id="loadingProgress"></div>
      </div>
      <div class="loading-text" id="loadingText">Memuat aplikasi...</div>
    </div>
    
    <div class="driver-badge fade-in delay-4">
      <span>üöó‚Äî</span>
      <span>Driver Mode - Siap Melayani</span>
    </div>

    <!-- Status Message untuk akun ditolak -->
    <div class="status-message error" id="rejectedMessage">
      <div class="status-title">Akun Driver Ditolak</div>
      <div class="status-desc">
        Maaf, status akun driver Anda ditolak. Hal ini bisa disebabkan oleh data yang tidak sesuai, 
        dokumen tidak lengkap, atau alasan lainnya. Silakan hubungi admin untuk informasi lebih lanjut 
        atau daftar ulang dengan data yang benar.
      </div>
      <div class="action-buttons">
        <button class="action-btn primary-btn" id="contactAdminBtn">Hubungi Admin</button>
        <button class="action-btn secondary-btn" id="registerAgainBtn">Daftar Ulang</button>
      </div>
    </div>

    <!-- Status Message untuk user biasa -->
    <div class="status-message" id="userMessage" style="background-color: rgba(30, 111, 92, 0.2); border: 1px solid rgba(30, 111, 92, 0.4);">
      <div class="status-title">Mode Pengguna Biasa</div>
      <div class="status-desc">
        Anda login sebagai pengguna biasa. Silakan pilih opsi di bawah ini:
      </div>
      <div class="action-buttons">
        <button class="action-btn primary-btn" id="goToUserAppBtn">Masuk sebagai User</button>
        <button class="action-btn secondary-btn" id="goToDriverBtn">Login sebagai Driver</button>
      </div>
    </div>
  </div>

  <div class="splash-footer fade-in delay-4">
    &copy; 2024 JeGo Gorontalo - Transportasi Digital
  </div>

  <script>
    // Firebase Configuration - KONSISTEN dengan yang baru
    const firebaseConfig = {
      apiKey: "AIzaSyDpGc_CsbNi1igA29n6qDhcX0oDkHNVscc",
      authDomain: "game-balap-simpel.firebaseapp.com",
      databaseURL: "https://game-balap-simpel-default-rtdb.firebaseio.com",
      projectId: "game-balap-simpel",
      storageBucket: "game-balap-simpel.firebasestorage.app",
      messagingSenderId: "864576853495",
      appId: "1:864576853495:web:6f16eb757fd3d8affb0af2",
      measurementId: "G-YWJPK7Y3J4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // Simulasi proses loading yang lebih realistis
    let progress = 0;
    const progressBar = document.getElementById('loadingProgress');
    const loadingText = document.getElementById('loadingText');
    const rejectedMessage = document.getElementById('rejectedMessage');
    const userMessage = document.getElementById('userMessage');
    
    // Daftar pesan loading yang relevan dengan Gorontalo
    const loadingMessages = [
      "Memuat aplikasi...",
      "Menyiapkan peta Gorontalo...",
      "Menghubungkan dengan driver...",
      "Mengambil data lokasi...",
      "Memeriksa status akun...",
      "Hampir selesai..."
    ];
    
    let messageIndex = 0;
    
    const loadingInterval = setInterval(() => {
      // Increment progress dengan pola yang lebih realistis
      if (progress < 30) {
        progress += Math.random() * 10;
      } else if (progress < 70) {
        progress += Math.random() * 8;
      } else {
        progress += Math.random() * 5;
      }
      
      if (progress > 100) progress = 100;
      
      progressBar.style.width = `${progress}%`;
      
      // Update pesan loading berdasarkan progress
      if (progress >= 20 && messageIndex < 1) {
        loadingText.textContent = loadingMessages[1];
        messageIndex = 1;
      } else if (progress >= 40 && messageIndex < 2) {
        loadingText.textContent = loadingMessages[2];
        messageIndex = 2;
      } else if (progress >= 60 && messageIndex < 3) {
        loadingText.textContent = loadingMessages[3];
        messageIndex = 3;
      } else if (progress >= 80 && messageIndex < 4) {
        loadingText.textContent = loadingMessages[4];
        messageIndex = 4;
      } else if (progress >= 90 && messageIndex < 5) {
        loadingText.textContent = loadingMessages[5];
        messageIndex = 5;
      }
      
      // Check driver status setelah loading selesai
      if (progress >= 100) {
        clearInterval(loadingInterval);
        checkUserOrDriverStatus();
      }
    }, 300);
    
    // Fungsi untuk memeriksa apakah user login sebagai driver atau user biasa
    function checkUserOrDriverStatus() {
      // Sembunyikan loading container
      document.querySelector('.loading-container').style.display = 'none';
      
      // Cek apakah ada user yang login (melalui Firebase Auth)
      auth.onAuthStateChanged((firebaseUser) => {
        if (firebaseUser) {
          // User login dengan Google (Firebase Auth)
          console.log('User Firebase Auth ditemukan:', firebaseUser.email);
          checkFirebaseUserStatus(firebaseUser);
        } else {
          // Cek apakah ada user di localStorage (sistem lama)
          const loggedInUser = localStorage.getItem('jego_logged_in_user');
          const driverData = localStorage.getItem('jego_driver_data');
          
          if (driverData && driverData !== '{}') {
            // Ada data driver di localStorage
            console.log('Driver data found in localStorage');
            checkDriverStatusFromLocalStorage();
          } else if (loggedInUser && loggedInUser !== '{}') {
            // Ada data user biasa di localStorage
            console.log('User data found in localStorage');
            showUserModeOptions();
          } else {
            // Tidak ada user atau driver yang login
            console.log('No user or driver logged in');
            showUserModeOptions();
          }
        }
      });
    }

    // Fungsi untuk memeriksa status user Firebase Auth
    function checkFirebaseUserStatus(firebaseUser) {
      // Cek apakah user ini adalah driver atau user biasa
      const driverData = localStorage.getItem('jego_driver_data');
      
      if (driverData && driverData !== '{}') {
        // User memiliki data driver, cek status driver
        checkDriverStatusFromLocalStorage();
      } else {
        // User biasa, tampilkan opsi
        showUserModeOptions();
      }
    }

    // Fungsi untuk memeriksa status driver dari localStorage
    function checkDriverStatusFromLocalStorage() {
      const driverData = localStorage.getItem('jego_driver_data');
      
      if (driverData && driverData !== '{}') {
        const driverObj = JSON.parse(driverData);
        const driverId = driverObj.driverId;
        
        loadingText.textContent = "Memeriksa status driver...";
        
        const driversRef = database.ref('drivers/' + driverId);
        driversRef.once('value')
          .then((snapshot) => {
            const currentData = snapshot.val();
            
            if (currentData) {
              // Update data di localStorage dengan data terbaru dari Firebase
              const updatedData = { ...driverObj, ...currentData };
              localStorage.setItem('jego_driver_data', JSON.stringify(updatedData));
              
              // Tentukan redirect berdasarkan status langsung dari Firebase
              if (currentData.status === 'accepted') {
                // Jika status accepted, redirect ke list.html
                redirectToPage('list.html', 'Status akun driver diterima. Mengalihkan...');
              } else if (currentData.status === 'rejected') {
                // Jika status rejected, tampilkan pesan penolakan
                showRejectedMessage();
              } else {
                // Jika status pending atau lainnya, redirect ke DaftarDriver.html
                redirectToPage('DaftarDriver.html', 'Status akun pending. Mengalihkan...');
              }
            } else {
              // Jika data tidak ditemukan di Firebase, tampilkan opsi
              showUserModeOptions();
            }
          })
          .catch((error) => {
            console.error('Error checking driver status:', error);
            // Jika terjadi error, tampilkan opsi
            showUserModeOptions();
          });
      } else {
        // Tidak ada data driver, tampilkan opsi
        showUserModeOptions();
      }
    }

    // Fungsi untuk menampilkan opsi mode user
    function showUserModeOptions() {
      // Sembunyikan elemen driver badge
      document.querySelector('.driver-badge').style.display = 'none';
      
      // Tampilkan pesan user
      userMessage.style.display = 'block';
      userMessage.classList.add('fade-in');
    }

    // Fungsi untuk mengarahkan ke halaman tertentu
    function redirectToPage(page, message) {
      loadingText.textContent = message;
      setTimeout(() => {
        window.location.href = page;
      }, 1000);
    }
    
    // Fungsi untuk menampilkan pesan akun ditolak
    function showRejectedMessage() {
      // Sembunyikan elemen loading
      document.querySelector('.loading-container').style.display = 'none';
      document.querySelector('.driver-badge').style.display = 'none';
      userMessage.style.display = 'none';
      
      // Tampilkan pesan rejected
      rejectedMessage.style.display = 'block';
      rejectedMessage.classList.add('fade-in');
      
      // BATALKAN fallback timeout karena status rejected
      clearTimeout(fallbackTimeout);
    }
    
    // Event listener untuk tombol hubungi admin
    document.getElementById('contactAdminBtn').addEventListener('click', function() {
      const driverData = JSON.parse(localStorage.getItem('jego_driver_data') || '{}');
      const message = `Halo Admin JeGo, saya ${driverData.fullName || ''} ingin menanyakan alasan penolakan akun driver saya. Driver ID: ${driverData.driverId || ''}`;
      const encodedMessage = encodeURIComponent(message);
      const whatsappUrl = `https://wa.me/6283142889149?text=${encodedMessage}`;
      
      // Buka WhatsApp
      window.open(whatsappUrl, '_blank');
    });
    
    // Event listener untuk tombol daftar ulang
    document.getElementById('registerAgainBtn').addEventListener('click', function() {
      // Hapus data driver dari localStorage
      localStorage.removeItem('jego_driver_data');
      
      // Redirect ke halaman pendaftaran
      redirectToPage('DaftarDriver.html', 'Mengalihkan ke halaman pendaftaran...');
    });

    // Event listener untuk tombol masuk sebagai user
    document.getElementById('goToUserAppBtn').addEventListener('click', function() {
      // Cek apakah user sudah login
      auth.onAuthStateChanged((firebaseUser) => {
        if (firebaseUser) {
          // User sudah login dengan Google
          redirectToPage('jenis_kenderaan.html', 'Mengalihkan ke aplikasi user...');
        } else {
          // User belum login, arahkan ke login
          redirectToPage('loginReg.html', 'Mengalihkan ke halaman login...');
        }
      });
    });

    // Event listener untuk tombol login sebagai driver
    document.getElementById('goToDriverBtn').addEventListener('click', function() {
      // Arahkan ke login driver
      redirectToPage('loginDriver.html', 'Mengalihkan ke halaman login driver...');
    });
    
    // Fallback: redirect otomatis setelah 10 detik
    let fallbackTimeout = setTimeout(() => {
      // Cek apakah pesan rejected sedang ditampilkan
      if (rejectedMessage.style.display !== 'block' && userMessage.style.display !== 'block') {
        const driverData = localStorage.getItem('jego_driver_data');
        if (driverData && driverData !== '{}') {
          window.location.href = 'list.html';
        } else {
          // Default ke halaman login user
          window.location.href = 'loginReg.html';
        }
      }
    }, 10000);
    
    // Fungsi untuk mengirim data ke Kodular (jika diperlukan)
    function sendToKodular(data) {
      console.log('Mengirim data ke Kodular:', data);
      
      if (typeof window.AppInventor !== 'undefined' && window.AppInventor.setWebViewString) {
        try {
          window.AppInventor.setWebViewString(JSON.stringify(data));
        } catch (error) {
          console.error('Error mengirim data via AppInventor:', error);
        }
      }
      else if (typeof window.android !== 'undefined' && window.android.receiveData) {
        try {
          window.android.receiveData(JSON.stringify(data));
        } catch (error) {
          console.error('Error mengirim data via window.android:', error);
        }
      }
      else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.observe) {
        try {
          window.webkit.messageHandlers.observe.postMessage(data);
        } catch (error) {
          console.error('Error mengirim data via webkit.messageHandlers:', error);
        }
      }
    }
    
    // Kirim notifikasi saat splash screen dimuat
    document.addEventListener('DOMContentLoaded', function() {
      sendToKodular({
        action: 'splash_loaded',
        message: 'Splash screen JeGo Gorontalo berhasil dimuat',
        timestamp: new Date().toISOString()
      });
    });
  </script>
</body>
</html>
