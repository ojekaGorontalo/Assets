<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data Users</title>
<style>
    body { font-family: Arial; padding: 20px; }
    input { padding: 8px; width: 320px; margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 10px; font-size: 14px; }
    th { background: #f2f2f2; }
    .loading { text-align: center; color: #666; padding: 20px; }
    .error { text-align: center; color: red; padding: 20px; }
    .pending { background-color: #fff3cd; }
    .active { background-color: #d1ecf1; }
    .user-id { font-size: 12px; color: #666; }
</style>
</head>
<body>

<h3>Data Users</h3>
<input id="searchInput" placeholder="Cari nama, email, telepon, atau alamat...">

<div style="margin-bottom: 15px;">
    <strong>Total Users: <span id="totalUsers">0</span></strong>
</div>

<table>
<thead>
<tr>
    <th>User ID</th>
    <th>Nama</th>
    <th>Email</th>
    <th>Telepon</th>
    <th>Alamat</th>
    <th>Jenis Kelamin</th>
    <th>Status</th>
    <th>Tanggal Daftar</th>
</tr>
</thead>
<tbody id="userTable">
    <tr><td colspan="8" class="loading">Memuat data users...</td></tr>
</tbody>
</table>

<script>
// URL Firebase untuk users
const usersUrl = "https://ojeka-ba255-default-rtdb.firebaseio.com/users.json";

// Function untuk memuat dan menampilkan data users
async function loadUsers() {
    try {
        const response = await fetch(usersUrl);
        const data = await response.json();
        
        const tbody = document.getElementById("userTable");
        
        if (!data) {
            tbody.innerHTML = '<tr><td colspan="8" class="loading">Tidak ada data users</td></tr>';
            document.getElementById("totalUsers").textContent = "0";
            return;
        }
        
        tbody.innerHTML = '';
        
        // Convert object ke array dan tambahkan key sebagai user_id
        const usersArray = Object.entries(data).map(([userId, userData]) => {
            return {
                user_id: userId,
                ...userData
            };
        });
        
        // Update total users
        document.getElementById("totalUsers").textContent = usersArray.length;
        
        if (usersArray.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="loading">Tidak ada data users</td></tr>';
            return;
        }
        
        // Urutkan berdasarkan tanggal daftar (terbaru pertama)
        usersArray.sort((a, b) => new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar));
        
        usersArray.forEach(user => {
            const row = document.createElement("tr");
            
            // Format tanggal
            const registerDate = new Date(user.tanggalDaftar);
            const formattedDate = registerDate.toLocaleString('id-ID');
            
            // Tentukan class berdasarkan status
            if (user.status === 'pending') {
                row.className = 'pending';
            } else if (user.status === 'active') {
                row.className = 'active';
            }
            
            row.innerHTML = `
                <td><span class="user-id">${user.user_id || "-"}</span></td>
                <td><strong>${user.nama || "-"}</strong></td>
                <td>${user.email || "-"}</td>
                <td>${user.telepon || "-"}</td>
                <td>${user.alamat || "-"}</td>
                <td>${user.jenisKelamin || "-"}</td>
                <td>${user.status || "-"}</td>
                <td>${formattedDate}</td>
            `;
            tbody.appendChild(row);
        });
        
        setupSearch();
        console.log(`Data users loaded: ${usersArray.length} users`);
        
    } catch (error) {
        console.error("Error loading users data:", error);
        document.getElementById("userTable").innerHTML = 
            '<tr><td colspan="8" class="error">Gagal memuat data users: ' + error.message + '</td></tr>';
    }
}

// Function untuk setup pencarian
function setupSearch() {
    const searchInput = document.getElementById("searchInput");
    const tbody = document.getElementById("userTable");
    
    searchInput.addEventListener("keyup", function() {
        const value = this.value.toLowerCase();
        const rows = tbody.getElementsByTagName("tr");
        
        for (let i = 0; i < rows.length; i++) {
            let rowText = rows[i].textContent || rows[i].innerText;
            rows[i].style.display = rowText.toLowerCase().includes(value) ? "" : "none";
        }
    });
}

// Auto-refresh setiap 15 detik
function startAutoRefresh() {
    setInterval(loadUsers, 15000);
}

// Load data pertama kali
loadUsers();

// Mulai auto-refresh
startAutoRefresh();
</script>

</body>
</html>
